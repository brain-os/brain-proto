syntax = "proto3";

package jio.brain.proto.event;

option java_package = "com.jio.brain.proto.event";
option java_multiple_files = true;

import "jio/brain/proto/event/event_common.proto";
import "jio/brain/proto/quantity/quantity.proto";
import "jio/brain/proto/quantity/quantity_atomic.proto";
import "jio/brain/proto/feature/feature.proto";
import "jio/brain/proto/entity/entity.proto";
import "jio/brain/proto/base/token.proto";

message BrainMultivariateEvent {
  BrainRecordKey key = 1; // entity ids and contexts
  // key is feature key, attribute key, entity type, inference type
  map<uint32, jio.brain.proto.quantity.BrainQuantity> parameter_set = 2; // all BrainModelFeature will have same key
}

message BrainMultivariateEventSchema {
  BrainRecordKeySchema key = 1;
  map<string, BrainFunctionParameterSchema> feature_set = 3;
}

message BrainFunctionParameterSchema {
  oneof schema {
    jio.brain.proto.feature.BrainFeatureSchema feature = 1;
    jio.brain.proto.entity.BrainAttributeSchema attribute = 2;
    jio.brain.proto.feature.BrainInferenceSchema inference = 3;
    jio.brain.proto.base.BrainToken entity_token = 4;
    BrainEventContextSchema context = 5;
  }
}

message BrainMultivariateInferenceEventSchema {
  BrainRecordKeySchema key = 1;
  map<string, jio.brain.proto.feature.BrainInferenceSchema> inference_set = 3;
}

message BrainFunctionParameterSchemaType {
  oneof inout_is_one_of {
    string feature = 1;
    string inference = 2;
    string attribute = 3;
    string context = 4;
    string entity_type = 5;
  }
}


//////////////// INFERENCE EVENT /////////////////////////

message BrainMultivariateInferenceEvent {
  uint32 model_id = 1;
  oneof inference_is_one_of {
    BrainClassificationEvent classification = 2;
    BrainRegressionEvent regression = 3;
  }
}
//Name service call from Bridge
message BrainClassificationEvent {
  BrainRecordKey key = 1; // entity ids and contexts
  repeated jio.brain.proto.quantity.BrainAtomicQuantity classification = 2; // key is class (symbol or entity) and value is probability (between 0 and 1)
  map<uint64, double> probabilities = 3;
}
message BrainClassificationEventSchema {
  BrainRecordKeySchema key = 1;
 // jio.brain.proto.quantity.BrainQuantitySchema symbolic = 2;   // entity_id
  string collection_type = 2;     //  /agriculture/entity/crop or /agriculture/quantity/symbolic/disease
  // TODO should map to inference schema ??
}

message BrainRegressionEvent {
  BrainRecordKey key = 1; // entity ids and contexts
  // key - brain inference schema
  map<uint32, jio.brain.proto.quantity.BrainQuantity> inference_set = 2; // key -> inference_id , multi value regression
}
message BrainRegressionEventSchema {
  BrainRecordKeySchema key = 1;
  map<string, jio.brain.proto.feature.BrainInferenceSchema> inference = 2; // multi value regression
}