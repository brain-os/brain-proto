syntax = "proto3";

package jio.brain.proto.event;

option java_package = "com.jio.brain.proto.event";
option java_multiple_files = true;

import "google/protobuf/any.proto";
import "jio/brain/proto/base/token.proto";
import "jio/brain/proto/types/collection.proto";
import "jio/brain/proto/quantity/quantity.proto";
import "jio/brain/proto/quantity/quantity_atomic.proto";
import "jio/brain/proto/entity/entity.proto";
import "jio/brain/proto/event/tracing.proto";
import "jio/brain/proto/feature/feature.proto";
import "google/protobuf/timestamp.proto";
import "jio/brain/proto/event/multivariate_event.proto";
import "jio/brain/proto/event/image_event.proto";
import "jio/brain/proto/event/event_common.proto";
import "jio/brain/proto/os/deployment.proto";
import "jio/brain/proto/repository/feature/feature_repository.proto";
import "jio/brain/proto/repository/inference/inference_repository.proto";
import "jio/brain/proto/repository/knowledge/command.proto";
import "jio/brain/proto/feature/api/repository_route.proto";
import "jio/brain/proto/feature/api/feature_lake.proto";

/**
{
  "id" : 12345, // 12345 (generated) from schema <=> /telecom/network/event/lsr - will same for all LSR events
  "value" : {
    "entity_store" : [
      {
        "key" : 23456, // 23456 (generated) customer entity type id <=> /telecom/network/entity/subscriber  - will same for all customer entities
        "value" : [123456789] // uint64 id for specific subscriber or biz_id e.g. imsi
      },
      {
        "key" : 34567, // 23456 (generated) cell tower entity id <=> /telecom/network/entity/cell_tower  - will same for all cell towers entities
        "value" : [234567, 234568, 234569] // uint64 id for specific cell towers or biz_id e.g. ecgi
      }
    ]
  },
  "property_store" : [
    {
      "key" : 45372, // /telecom/network/property/lsr/start_time
      "value" : 45456 // actual value of time stamp
    }
  ]
}
 **/

message BrainEvent {
  uint32 id = 1;
  uint32 type = 2;
  BrainEventMetadata meta_data = 3;
  oneof event {
    BrainIngestionEvent ingestion_event = 4;
    BrainTransactionEvent transaction_event = 5;
    BrainKeyValueEvent key_value_event = 6;
    BrainFeatureKeyValueEvent feature_event = 7;
    BrainMultivariateEvent multivariate_event = 8;
    BrainMultivariateInferenceEvent multivariate_inference_event = 9;
    BrainIotEvent iot_event = 10;
    BrainImageEvent image_event = 11;
    BrainImageClassificationEvent image_classification = 12;
    BrainInfraEvent infra_event = 13;
  }
}

message BrainEventMetadata {
  repeated BrainEventTrace trace = 1;
  google.protobuf.Timestamp created_time = 2;
  google.protobuf.Timestamp end_time = 3;
}

message BrainIngestionEvent {
  oneof source {
    string csv_file_path = 1;
    string excel_file_path = 2;
    string json_file_path = 3;
    google.protobuf.Any message = 4;
  }
  uint32 startReadingLineNumber = 5;
}

message BrainKeyValueEvent {
  BrainEventKey key = 1;
  BrainEventValue value = 2;
}

message BrainEventKeyMultiValue {
  BrainEventKey key = 1;
  repeated BrainEventValue values = 2;
}

message BrainEventKey {
  BrainEntityStore entity_store = 1;
  BrainQuantityStore context_store = 2;
  BrainAttributeStore attribute_store = 3;
  BrainEntityPredicateStore predicate_store = 4;
}

message BrainEventValue {
  BrainEntityStore entity_store = 1;
  BrainQuantityStore property_store = 2;
  BrainAttributeStore attribute_store = 3;
  BrainEntityPredicateStore predicate_store = 4;
  BrainEventFeatureValue feature_store = 5;
}

message BrainFeatureKeyValueEvent {
  BrainEventKey feature_key = 1;
  BrainEventFeatureValue feature_value = 2;
}
message BrainEventFeatureValue {
  map<uint32, jio.brain.proto.quantity.BrainQuantity> value = 1;
  // BrainAttributeStore attribute_store = 2;
}

//message BrainFeatureSetStore {
//  oneof feature {
//    jio.brain.proto.feature.BrainFeatureSet features = 1;
//    jio.brain.proto.feature.BrainFeatureFamily  feature_family = 2;   // TBD for usage in feature lake
//  }
//}

//message BrainEntityStore {
//  // Key = mid(/m/<vertical>/<domain>/entity/<entity-type>)
//  // Value = A Set of entities of key type
//  // entities[<entity-type>].elements[<entity-id>] = true
//  map<uint32, jio.brain.proto.types.BrainEntitySet> entities = 1;
//}
//message BrainQuantityStore {
//  // key = machine_id for whatever role it is playing
//  // Note: This is NOT quantity type but the role_type
//  // e.g. context, property,
//  // e.g. attribute, attribute_qualifier,
//  // e.g. predicate, predicate_qualifier
//  map<uint32, jio.brain.proto.quantity.BrainQuantity> value = 1;
//}

message BrainAttributeStore {
  // key = mid(/m/<vertical>/<domain>/entity/<entity-type>)
  map<uint32, BrainEntityAttributeStore> attributes = 1;
}
message BrainEntityAttributeStore {
  // key = <entity-id> (attributes of these entities)
  map<uint64, jio.brain.proto.entity.BrainAttributeSet> attribute_set = 1;
}
message BrainPredicateStore {
  // key = mid(/m/<vertical>/<domain>/predicate/<subject-type>/<predicate-name>/<object-type>)
  map<uint32, BrainEntityPredicateStore> predicate = 1;
}
message BrainEntityPredicateStore {
  // key = entity id
  map<uint64, jio.brain.proto.entity.BrainPredicateSet> predicate = 1;
}
/*
BrainIngestionEvent ingestion_event = 4;
    BrainTransactionEvent transaction_event = 5;
    BrainKeyValueEvent key_value_event = 6;
    BrainEventFeatureKeyValue feature_event = 7;
    BrainMultivariateEvent multivariate_event = 8;
    BrainIotEvent iot_event = 9;
    BrainImageEvent image_event = 10;
    BrainImageClassificationEvent image_classification = 11;
 */
message BrainEventSchema {
  jio.brain.proto.base.BrainToken token = 1;
  oneof event_schema {
    BrainIngestionEventSchema ingestion_event = 2;
    BrainTransactionEventSchema transaction_event = 3;
    BrainEventKeyValueSchema key_value_event = 4;
    BrainEventFeatureKeyValueSchema feature_event = 5;
    BrainMultivariateEventSchema multivariate_event = 6;
    BrainIotEventSchema iot_event = 7;
    BrainImageEventSchema image_event = 8;
    BrainImageClassificationEventSchema image_classification_event = 9;
  }
}
message BrainIngestionEventSchema {
  string name = 1;
}

message BrainEventKeySchema {
  BrainEntityStoreSchema entity = 1;
  // key = mid(/m/<vertical>/<domain>/<event>/<context>)
  map<string, BrainEventContextSchema> context = 2;
}

message BrainEventValueSchema {
  BrainEntityStoreSchema entity = 1;
  // key = mid(/m/<vertical>/<domain>/<event>/<property>)
  map<string, BrainEventPropertySchema> property = 2;
}

message BrainEventKeyValueSchema {
  BrainEventKeySchema key = 1;
  BrainEventValueSchema value = 2;
}
message BrainEventFeatureKeyValueSchema {
  BrainEventKeySchema key = 1;
  BrainEventFeatureValueSchema value = 2;
}

message BrainEventFeatureValueSchema {
  // key = mid(/m/<vertical>/<domain>/<event>/<property>)
  jio.brain.proto.feature.BrainFeatureSetSchema features = 1;
  //jio.brain.proto.entity.BrainAttributeSetSchema attribute_schema = 2; // TODO remove schema
}

//message BrainEntityStoreSchema {
//  // key = mid(/m/<vertical>/<domain>/entity/<entity-type>)
//  map<string, jio.brain.proto.entity.BrainEntitySchema> entity = 1;
//}
//message BrainEventContextSchema {
//  jio.brain.proto.base.BrainToken token = 1;
//  jio.brain.proto.quantity.BrainQuantitySchema quantity = 2;
//  // BrainToken unit = 3;
//}
message BrainEventPropertySchema {
  jio.brain.proto.base.BrainToken token = 1;
  jio.brain.proto.quantity.BrainQuantitySchema quantity = 2;
  jio.brain.proto.base.BrainToken unit = 3;
}
message BrainTransactionEventSchema {

}
message BrainIotEventSchema {
  oneof iot_event_is_one_of {
    BrainIotSensorEventSchema sensor = 1;
    BrainIotSensorIp21EventSchema ip21 = 2;
  }
}
message BrainIotSensorEventSchema {
  BrainEntityStoreSchema entity = 1; // information about sensor id
  google.protobuf.Timestamp time_stamp = 2;
  map<string, jio.brain.proto.quantity.BrainQuantitySchema> property = 3;
}

message BrainIotSensorEvent {
  BrainEntityStoreSchema entity = 1; // information about sensor id
  google.protobuf.Timestamp time_stamp = 2;
  map<string, jio.brain.proto.quantity.BrainQuantity> property = 3;
}
message BrainIotSensorIp21EventSchema {
  google.protobuf.Timestamp from_time_stamp = 1;
  google.protobuf.Timestamp to_time_stamp = 2;
  //  repeated BrainIotRecord data = 3;
  map<uint64, jio.brain.proto.quantity.BrainQuantitySchema> data = 3; // key is brain id
}
message BrainIotSensorIp21Event {
  google.protobuf.Timestamp from_time_stamp = 1;
  google.protobuf.Timestamp to_time_stamp = 2;
  //  repeated BrainIotRecord data = 3;
  map<uint64, BrainIotRecord> data = 3; // key is brain id
}
message BrainIotRecordSchema {
  jio.brain.proto.quantity.BrainQuantitySchema quantity = 1;
}
message BrainIotRecord {
  google.protobuf.Timestamp time_stamp = 1;
  bool is_good = 2;
  jio.brain.proto.quantity.BrainQuantity quantity = 3;
}
//message BrainEventKeyMultiValueSchema {
//  BrainEventKeySchema key = 1;
//  repeated BrainEventValueSchema value = 2;
//}
message BrainTransactionEvent {
  BrainEventValue value = 1;
}

message BrainIotEvent {

}

message BrainInfraEvent {
  oneof infra_event_is_one_of {
    BrainIngestionEvent ingestion_event = 1;
    jio.brain.proto.os.DeploymentRequest deployment_request = 2;
    jio.brain.proto.repository.feature.FeatureCommand feature_command = 3;
    jio.brain.proto.repository.inference.InferenceCommand inference_command = 4;
    jio.brain.proto.repository.knowledge.EntityCommand entity_command = 5;
    jio.brain.proto.feature.api.RepositoryRouterTopics repository_router_topic = 6;
    jio.brain.proto.feature.api.BrainFunctionNameSet brain_function_name_set = 7;
  }
}

//message BrainMultivariateEvent {
//  jio.brain.proto.event.BrainEventKey key = 1;                         // entity ids and contexts
//  map<uint32, jio.brain.proto.quantity.BrainQuantity> feature_set = 3; // can be attributes or features or inference
//}

// f1  -> key-> cell-id * morning, features-> x1, x2, x3
/** function_config ->
name -> casualty_model_bridge_config,
input_event_schema -> key-value
ouput_event_schema -> key-value

input -> x1,x2,x3 , a1, c1, e1
ouput -> x4,x5
 */

//message BrainMultivariateEventSchema {
//  jio.brain.proto.event.BrainEventKeySchema key = 1;
//  repeated jio.brain.proto.feature.BrainFeatureSchema feature_set = 2;
//  // map<uint32, jio.brain.proto.feature.BrainFeatureSchema> feature_set = 2; // key = index in array, value = feature schema
//}

//message BrainMultivariateInferenceEvent {
//  oneof inference_is_one_of {
//    BrainClassificationEvent classification = 1;
//    BrainRegressionEvent regression = 2;
//  }
//}
//
//message BrainClassificationEventSchema {
//  jio.brain.proto.event.BrainEventKeySchema key = 1;
//  jio.brain.proto.quantity.BrainSymbolicQuantitySchema symbolic = 2;
//}
//
//message BrainClassificationEvent {
//  jio.brain.proto.event.BrainEventKey key = 1;
//  map<uint64, double> classification = 2; // key is class (symbol or entity) and value is probability (between 0 and 1)
//}
//message BrainRegressionEventSchema {
//  jio.brain.proto.event.BrainEventKeySchema key = 1;
//  map<string, jio.brain.proto.quantity.BrainNumericQuantitySchema> inference_set = 2; // multi value regression
//}
//
//message BrainRegressionEvent {
//  jio.brain.proto.event.BrainEventKey key = 1;
//  map<uint32, jio.brain.proto.quantity.BrainNumericQuantity> inference_set = 2; // multi value regression
//}