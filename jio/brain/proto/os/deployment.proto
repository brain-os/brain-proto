syntax = "proto3";

package jio.brain.proto.os;

option java_package = "com.jio.brain.proto.os";
option java_multiple_files = true;

message DeploymentRequest{
  string instance_id = 1;
  repeated Process process = 2;
  bool deleteDeployment = 3;
}

message Process {
  int64  id = 1;
  string key_token = 2;
  string name = 3;
  ProcessType type = 4;
  MessageService messageService = 5;

  oneof input_is_one_of {
    string input_topic = 6;
    string inputExchange = 7;
  }
  oneof output_is_one_of {
    OutputTopic outputTopics = 8;
    string outputExchange = 9;
  }

}

message OutputTopic{
  repeated string output_topic = 1;
}

enum MessageService {
  rabbitMq = 0;
  kafka = 1;
  rabbitMqToKafka = 2;
  kafkaToRabbitMq = 3;
}

enum ProcessType {
  ingestion = 0;
  enrich = 1;
  quantization = 2;
  filter = 3;
  pivot = 4;
  joiner = 5;
  reduce = 6;
  compute = 7;
}

enum ProcessStatus {
  NEW = 0;
  STARTING = 1;
  RUNNING = 2;
  DEPLOYMENT_ERROR = 3;
  STOPPING = 4;
  STOPPED = 5;

}

message InstanceStatus {
  string instanceId = 1;
  string input_topic = 2;
  InstanceType instance_type = 3;
  InstanceDeploymentStatus deploy_status = 4;
  map<int64, ProcessStatus> process_status = 5;

  enum InstanceDeploymentStatus{
    DRAFT = 0;
    RUNNING = 1;
    DEPLOYMENT_ERROR = 2;
    STARTING = 3;
    STOPPING = 4;
    STOPPED = 5;
    TOPIC_CREATED = 6;
    TOPIC_CREATION_ERROR = 7;
    DEPLOYED = 8;
  }
}



enum InstanceType {
  ENRICH = 0;
  FILTER = 1;
  PIVOT = 2;
  REDUCE = 3;
  INGESTION = 4;
  QUANTIZATION = 5;
  JOINER = 6;
  COMPUTE = 7;
}